{% extends "base.html" %}
{% load static wagtailimages_tags %}

{% block content %}
<div class="container my-5">
  <div class="row">
    <div class="col-lg-8 mx-auto">

      {% if item_page %}
      <div class="card shadow-sm mb-4">
        <div class="card-body d-flex align-items-center">
          <div class="me-3">
            {% if item_image %}
              {% image item_image fill-120x120 class="rounded" alt=item_title %}
            {% else %}
              <div class="bg-light rounded d-flex align-items-center justify-content-center" style="width:120px;height:120px;">
                <span class="text-muted small">No image</span>
              </div>
            {% endif %}
          </div>
          <div class="flex-grow-1">
            <h5 class="mb-1">{{ item_title }}</h5>
            {% if item_price %}
              <div class="text-success fw-semibold fs-5">â‚¬{{ item_price }}</div>
            {% endif %}
            <div class="text-muted small">Review your order details below.</div>
          </div>
          <div>
            <a href="{{ item_page.url }}" class="btn btn-outline-secondary btn-sm">View item</a>
          </div>
        </div>
      </div>
      {% endif %}

            <h1 class="text-center mb-4">Place Your Order</h1>
            <p class="lead text-center mb-5">Fill out the form below to place your printing order.</p>
            
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}
            
            <form method="post" class="needs-validation" novalidate>
                {% csrf_token %}
                
                <!-- Customer Information -->
                <div class="card mb-4">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0"><i class="fas fa-user me-2"></i>Customer Information</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.first_name.id_for_label }}" class="form-label">First Name *</label>
                                {{ form.first_name }}
                                {% if form.first_name.errors %}
                                    <div class="text-danger mt-1">{{ form.first_name.errors.0 }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.last_name.id_for_label }}" class="form-label">Last Name *</label>
                                {{ form.last_name }}
                                {% if form.last_name.errors %}
                                    <div class="text-danger mt-1">{{ form.last_name.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.email.id_for_label }}" class="form-label">Email Address *</label>
                                {{ form.email }}
                                {% if form.email.errors %}
                                    <div class="text-danger mt-1">{{ form.email.errors.0 }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.phone.id_for_label }}" class="form-label">Phone Number *</label>
                                {{ form.phone }}
                                {% if form.phone.errors %}
                                    <div class="text-danger mt-1">{{ form.phone.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Shipping Address -->
                <div class="card mb-4">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0"><i class="fas fa-map-marker-alt me-2"></i>Shipping Address</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="{{ form.street_address.id_for_label }}" class="form-label">Street Address *</label>
                            {{ form.street_address }}
                            {% if form.street_address.errors %}
                                <div class="text-danger mt-1">{{ form.street_address.errors.0 }}</div>
                            {% endif %}
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="{{ form.city.id_for_label }}" class="form-label">City *</label>
                                {{ form.city }}
                                {% if form.city.errors %}
                                    <div class="text-danger mt-1">{{ form.city.errors.0 }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="{{ form.state.id_for_label }}" class="form-label">State *</label>
                                {{ form.state }}
                                {% if form.state.errors %}
                                    <div class="text-danger mt-1">{{ form.state.errors.0 }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="{{ form.zip_code.id_for_label }}" class="form-label">ZIP Code *</label>
                                {{ form.zip_code }}
                                {% if form.zip_code.errors %}
                                    <div class="text-danger mt-1">{{ form.zip_code.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="{{ form.country.id_for_label }}" class="form-label">Country *</label>
                            {{ form.country }}
                            {% if form.country.errors %}
                                <div class="text-danger mt-1">{{ form.country.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- Payment Information -->
                <div class="card mb-4">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0"><i class="fas fa-credit-card me-2"></i>Payment Information</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="{{ form.card_holder_name.id_for_label }}" class="form-label">Name on Card *</label>
                            {{ form.card_holder_name }}
                            {% if form.card_holder_name.errors %}
                                <div class="text-danger mt-1">{{ form.card_holder_name.errors.0 }}</div>
                            {% endif %}
                        </div>
                        <div class="mb-3">
                            <label for="{{ form.card_number.id_for_label }}" class="form-label">Card Number *</label>
                            {{ form.card_number }}
                            {% if form.card_number.errors %}
                                <div class="text-danger mt-1">{{ form.card_number.errors.0 }}</div>
                            {% endif %}
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.expiry_date.id_for_label }}" class="form-label">Expiry Date *</label>
                                {{ form.expiry_date }}
                                <div class="form-text">Format: MM/YYYY</div>
                                {% if form.expiry_date.errors %}
                                    <div class="text-danger mt-1">{{ form.expiry_date.errors.0 }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.cvv.id_for_label }}" class="form-label">CVV *</label>
                                {{ form.cvv }}
                                <div class="form-text">3 or 4 digit security code</div>
                                {% if form.cvv.errors %}
                                    <div class="text-danger mt-1">{{ form.cvv.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Order Details -->
                <div class="card mb-4">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0"><i class="fas fa-clipboard-list me-2"></i>Order Details</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="{{ form.order_details.id_for_label }}" class="form-label">What do you need printed? *</label>
                            {{ form.order_details }}
                            <div class="form-text">Please describe your printing requirements in detail (quantity, size, paper type, colors, etc.)</div>
                            {% if form.order_details.errors %}
                                <div class="text-danger mt-1">{{ form.order_details.errors.0 }}</div>
                            {% endif %}
                        </div>
                        <div class="mb-3">
                            <label for="{{ form.special_instructions.id_for_label }}" class="form-label">Special Instructions</label>
                            {{ form.special_instructions }}
                            <div class="form-text">Any additional notes or requirements (optional)</div>
                            {% if form.special_instructions.errors %}
                                <div class="text-danger mt-1">{{ form.special_instructions.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- Form Actions -->
                <div class="text-center mb-4">
                    <button type="submit" class="btn btn-dark btn-lg me-3">
                        <i class="fas fa-paper-plane me-2"></i>
                        Submit Order
                    </button>
                    <a href="javascript:history.back()" class="btn btn-secondary btn-lg">
                 <i class="fas fa-arrow-left me-2"></i>
                     Go Back
                </a>
                </div>
            
            </form>
        </div>
    </div>
</div>

<!-- Form Validation JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Format card number as user types
    const cardNumberInput = document.getElementById('{{ form.card_number.id_for_label }}');
    if (cardNumberInput) {
        cardNumberInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
            let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
            e.target.value = formattedValue;
        });
    }
    
    // Format expiry date
    const expiryInput = document.getElementById('{{ form.expiry_date.id_for_label }}');
    if (expiryInput) {
        expiryInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length >= 2) {
                value = value.substring(0,2) + '/' + value.substring(2,6);
            }
            e.target.value = value;
        });
    }
    
    // CVV numeric only
    const cvvInput = document.getElementById('{{ form.cvv.id_for_label }}');
    if (cvvInput) {
        cvvInput.addEventListener('input', function(e) {
            e.target.value = e.target.value.replace(/\D/g, '').substring(0,4);
        });
    }
});
</script>
{% endblock %}